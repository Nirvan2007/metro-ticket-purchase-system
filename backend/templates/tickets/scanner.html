{% extends 'tickets/base.html' %}
{% block content %}
<main class="page">
<div class="full-card">
<h2>Ticket Scanner</h2>
{% if error %}<p style='color:rgb(255, 0, 0)'>{{ error }}</p>{% endif %}
{% if message %}<p style='color:rgb(0, 42, 255)'>{{ message }}</p>{% endif %}
<form method='post'>{% csrf_token %}
<p>Select ticket to mark enter/exit.</p>
  <select id='ticket_id' name='ticket_id'>
    {% for t in tickets %}
    <option value='{{ t.id }}'>{{ t.id }}: {{ t.start.name }} â†’ {{ t.end.name }}</option>
    {% endfor %}
  </select>
<button class="view-btn" formaction="/scanner/?action=enter">Enter</button>
<button class="view-btn" formaction="/scanner/?action=exit">Exit</button>
</form>
<div id='result'></div>
<script>
function api(action){
  const id = document.getElementById('ticket_id').value;
  fetch('/api/scan/'+id+'/?action='+action).then(r=>r.json()).then(j=>{
    document.getElementById('result').innerText = JSON.stringify(j);
  }).catch(e=>alert('Error: '+e));
}
function enter(){ api('enter'); }
function exit(){ api('exit'); }
</script>
</div></main> 
{% endblock %}
